{"ast":null,"code":"import _objectSpread from \"/Users/kaiweiwu/Documents/page_designer/client/node_modules/@babel/runtime/helpers/esm/objectSpread\";\nvar _jsxFileName = \"/Users/kaiweiwu/Documents/page_designer/client/src/FundSelection.js\";\nimport React from \"react\";\nimport uniqueId from \"lodash/uniqueId\";\nimport SortableList from \"./SortableList\";\n\nlet base64 = require(\"base-64\");\n\nlet url = \"https://test-api.mobileaxept.com/micro_service/page-properties\";\nlet username = \"spencer.grimes@mobileaxept.com\";\nlet password = \"Temp654321\";\nlet headers = {\n  Authorization: \"Basic \" + base64.encode(username + \":\" + password),\n  \"Content-Type\": \"application/json\"\n};\n\nclass FundSelection extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.getKeyByValue = (object, value) => {\n      return Object.keys(object).find(key => object[key] === value);\n    };\n\n    this.autoSaveOptions = new_value => {\n      const client_code = this.props.clientCode;\n      const pageId = this.props.pageId;\n      const field = \"accnos\";\n      let body = {\n        client_code: client_code,\n        page_id: pageId,\n        field: field,\n        new_value: new_value\n      };\n      fetch(url, {\n        method: \"POST\",\n        headers: headers,\n        mode: \"cors\",\n        body: JSON.stringify(body)\n      }).then(response => {\n        if (response.ok) {\n          console.log(response);\n          return response.json();\n        } else {\n          throw new Error(\"Something went wrong ...\");\n        }\n      }).then(data => {\n        console.log(data);\n      }).catch(error => console.log(error));\n    };\n\n    this.onAddingOption = option => {\n      const isChecked = option.target.checked;\n      const name = option.target.name;\n      const value = option.target.value;\n      this.setState(prevState => ({\n        optionList: prevState.optionList.map(option => option.name === value ? _objectSpread({}, option, {\n          isChecked: isChecked\n        }) : option)\n      }));\n\n      if (isChecked) {\n        this.setState(prevState => ({\n          optionsChecked: [...prevState.optionsChecked, {\n            accno: name,\n            name: value\n          }]\n        }));\n        this.setState(prevState => ({\n          sortableArray: [...prevState.sortableArray, value]\n        }));\n      } else {\n        const newoptionsChecked = this.state.optionsChecked.filter(option => option.name !== value);\n        this.setState({\n          optionsChecked: newoptionsChecked\n        });\n        const newSortableArray = this.state.sortableArray.filter(option => option !== value);\n        this.setState({\n          sortableArray: newSortableArray\n        });\n      }\n    };\n\n    this.state = {\n      optionList: [],\n      //{ name: \"apples\", isChecked: false }, { name: \"Banana\", isChecked: false }\n      optionsChecked: [],\n      fundLibrary: {},\n      isLoading: false,\n      error: null,\n      sortableArray: []\n    };\n  }\n\n  componentDidMount() {\n    const client_code = this.props.clientCode;\n    const pageId = this.props.pageId;\n    this.setState({\n      isLoading: true\n    });\n    let fundLibrary = null;\n    let fundListUrl = url + \"?client_code=\" + client_code + \"&field=availableFundAccnos\";\n    fetch(fundListUrl, {\n      method: \"GET\",\n      headers: headers,\n      mode: \"cors\"\n    }).then(response => {\n      if (response.ok) {\n        return response.json();\n      } else {\n        throw new Error(\"Can't fetch fund options ...\");\n      }\n    }).then(data => {\n      fundLibrary = data;\n      this.setState({\n        fundLibrary: data\n      });\n\n      for (var element in data) {\n        let fundName = data[element];\n        let option_object = {\n          name: fundName,\n          accno: element,\n          isChecked: false\n        };\n        let new_array = this.state.optionList.concat(option_object);\n        this.setState({\n          optionList: new_array\n        });\n      }\n\n      let fundSelectionUrl = url + \"?client_code=\" + client_code + \"&page_id=\" + pageId + \"&field=accnos\";\n      fetch(fundSelectionUrl, {\n        method: \"GET\",\n        headers: headers,\n        mode: \"cors\"\n      }).then(response => {\n        if (response.ok) {\n          return response.json();\n        } else {\n          throw new Error(\"Can't fetch selected funds ...\");\n        }\n      }).then(data => {\n        let accnosArray = data.value.split(\",\");\n        const length = accnosArray.length;\n\n        for (let i = 0; i < length; i++) {\n          let accno = accnosArray[i];\n          let fundName = fundLibrary[accno];\n          this.setState(prevState => ({\n            optionList: prevState.optionList.map(option => option.name === fundName ? _objectSpread({}, option, {\n              isChecked: true\n            }) : option)\n          }));\n          this.setState(prevState => ({\n            optionsChecked: [...prevState.optionsChecked, {\n              accno: accno,\n              name: fundName\n            }]\n          }));\n          this.setState(prevState => ({\n            sortableArray: [...prevState.sortableArray, fundName]\n          }));\n        }\n\n        this.setState({\n          isLoading: false\n        });\n      }).catch(error => this.setState({\n        error,\n        isLoading: false\n      }));\n    }).catch(error => this.setState({\n      error,\n      isLoading: false\n    }));\n  }\n\n  componentDidUpdate(prevProps, prevState) {\n    //Can also use JSON.stringfy to convert two arrays into a string and compare them directly\n    if (JSON.stringify(prevState.sortableArray) !== JSON.stringify(this.state.sortableArray)) {\n      let new_array = this.state.sortableArray.map(option => this.getKeyByValue(this.state.fundLibrary, option));\n      let new_string = new_array.join(\",\");\n      this.autoSaveOptions(new_string);\n    }\n  }\n\n  render() {\n    if (this.state.error) {\n      return React.createElement(\"p\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 203\n        },\n        __self: this\n      }, this.state.error.message);\n    }\n\n    if (this.state.isLoading) {\n      return React.createElement(\"div\", {\n        className: \"loader\",\n        id: \"loader-1\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 207\n        },\n        __self: this\n      }, React.createElement(\"span\", {\n        className: \"sr-only\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 208\n        },\n        __self: this\n      }, \"Loading...\"));\n    }\n\n    const option_list = this.state.optionList.map(option => // const id = \"inlineCheckbox\" + i.toString();\n    React.createElement(\"label\", {\n      key: uniqueId(),\n      className: \"checkbox-inline col-md-3\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 214\n      },\n      __self: this\n    }, React.createElement(\"input\", {\n      type: \"checkbox\",\n      name: option.accno,\n      value: option.name,\n      checked: option.isChecked,\n      onChange: this.onAddingOption,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 215\n      },\n      __self: this\n    }), option.name));\n    return React.createElement(\"div\", {\n      id: \"giving-options\",\n      className: \"giving-options\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 227\n      },\n      __self: this\n    }, React.createElement(\"h3\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 228\n      },\n      __self: this\n    }, \"Giving Options\"), React.createElement(\"div\", {\n      className: \"apperance\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 229\n      },\n      __self: this\n    }, React.createElement(\"h4\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 230\n      },\n      __self: this\n    }, \"Apperance\"), React.createElement(\"span\", {\n      className: \"help-block\",\n      id: \"helpBlock\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 231\n      },\n      __self: this\n    }, \"Choose which funds are visible on the page\"), React.createElement(\"form\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 235\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"multi-selection-fund row\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 236\n      },\n      __self: this\n    }, option_list)), React.createElement(\"div\", {\n      className: \"ordering\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 240\n      },\n      __self: this\n    }, React.createElement(\"h4\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 241\n      },\n      __self: this\n    }, \"Ordering\"), React.createElement(\"span\", {\n      className: \"help-block\",\n      id: \"helpBlock\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 242\n      },\n      __self: this\n    }, \"Choose which order the funds are displayed on the page\"), React.createElement(\"div\", {\n      id: \"simpleList\",\n      className: \"list-group\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 246\n      },\n      __self: this\n    }, React.createElement(SortableList, {\n      items: this.state.sortableArray,\n      onChange: (order, sortable, evt) => {\n        this.setState({\n          sortableArray: order\n        });\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 247\n      },\n      __self: this\n    })))));\n  }\n\n}\n\nexport default FundSelection;","map":{"version":3,"sources":["/Users/kaiweiwu/Documents/page_designer/client/src/FundSelection.js"],"names":["React","uniqueId","SortableList","base64","require","url","username","password","headers","Authorization","encode","FundSelection","Component","constructor","props","getKeyByValue","object","value","Object","keys","find","key","autoSaveOptions","new_value","client_code","clientCode","pageId","field","body","page_id","fetch","method","mode","JSON","stringify","then","response","ok","console","log","json","Error","data","catch","error","onAddingOption","option","isChecked","target","checked","name","setState","prevState","optionList","map","optionsChecked","accno","sortableArray","newoptionsChecked","state","filter","newSortableArray","fundLibrary","isLoading","componentDidMount","fundListUrl","element","fundName","option_object","new_array","concat","fundSelectionUrl","accnosArray","split","length","i","componentDidUpdate","prevProps","new_string","join","render","message","option_list","order","sortable","evt"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport uniqueId from \"lodash/uniqueId\";\nimport SortableList from \"./SortableList\";\n\nlet base64 = require(\"base-64\");\nlet url = \"https://test-api.mobileaxept.com/micro_service/page-properties\";\nlet username = \"spencer.grimes@mobileaxept.com\";\nlet password = \"Temp654321\";\n\nlet headers = {\n    Authorization: \"Basic \" + base64.encode(username + \":\" + password),\n    \"Content-Type\": \"application/json\"\n};\n\nclass FundSelection extends React.Component {\n    constructor(props) {\n        super(props);\n        this.state = {\n            optionList: [], //{ name: \"apples\", isChecked: false }, { name: \"Banana\", isChecked: false }\n            optionsChecked: [],\n            fundLibrary: {},\n            isLoading: false,\n            error: null,\n            sortableArray: []\n        };\n    }\n\n    componentDidMount() {\n        const client_code = this.props.clientCode;\n        const pageId = this.props.pageId;\n        this.setState({ isLoading: true });\n        let fundLibrary = null;\n        let fundListUrl =\n            url + \"?client_code=\" + client_code + \"&field=availableFundAccnos\";\n        fetch(fundListUrl, {\n            method: \"GET\",\n            headers: headers,\n            mode: \"cors\"\n        })\n            .then(response => {\n                if (response.ok) {\n                    return response.json();\n                } else {\n                    throw new Error(\"Can't fetch fund options ...\");\n                }\n            })\n            .then(data => {\n                fundLibrary = data;\n                this.setState({ fundLibrary: data });\n                for (var element in data) {\n                    let fundName = data[element];\n                    let option_object = {\n                        name: fundName,\n                        accno: element,\n                        isChecked: false\n                    };\n                    let new_array = this.state.optionList.concat(option_object);\n                    this.setState({\n                        optionList: new_array\n                    });\n                }\n\n                let fundSelectionUrl =\n                    url +\n                    \"?client_code=\" +\n                    client_code +\n                    \"&page_id=\" +\n                    pageId +\n                    \"&field=accnos\";\n                fetch(fundSelectionUrl, {\n                    method: \"GET\",\n                    headers: headers,\n                    mode: \"cors\"\n                })\n                    .then(response => {\n                        if (response.ok) {\n                            return response.json();\n                        } else {\n                            throw new Error(\"Can't fetch selected funds ...\");\n                        }\n                    })\n                    .then(data => {\n                        let accnosArray = data.value.split(\",\");\n                        const length = accnosArray.length;\n                        for (let i = 0; i < length; i++) {\n                            let accno = accnosArray[i];\n                            let fundName = fundLibrary[accno];\n                            this.setState(prevState => ({\n                                optionList: prevState.optionList.map(option =>\n                                    option.name === fundName\n                                        ? { ...option, isChecked: true }\n                                        : option\n                                )\n                            }));\n                            this.setState(prevState => ({\n                                optionsChecked: [\n                                    ...prevState.optionsChecked,\n                                    { accno: accno, name: fundName }\n                                ]\n                            }));\n                            this.setState(prevState => ({\n                                sortableArray: [\n                                    ...prevState.sortableArray,\n                                    fundName\n                                ]\n                            }));\n                        }\n\n                        this.setState({ isLoading: false });\n                    })\n                    .catch(error => this.setState({ error, isLoading: false }));\n            })\n            .catch(error => this.setState({ error, isLoading: false }));\n    }\n\n    getKeyByValue = (object, value) => {\n        return Object.keys(object).find(key => object[key] === value);\n    };\n\n    componentDidUpdate(prevProps, prevState) {\n        //Can also use JSON.stringfy to convert two arrays into a string and compare them directly\n        if (\n            JSON.stringify(prevState.sortableArray) !==\n            JSON.stringify(this.state.sortableArray)\n        ) {\n            let new_array = this.state.sortableArray.map(option =>\n                this.getKeyByValue(this.state.fundLibrary, option)\n            );\n\n            let new_string = new_array.join(\",\");\n            this.autoSaveOptions(new_string);\n        }\n    }\n\n    autoSaveOptions = new_value => {\n        const client_code = this.props.clientCode;\n        const pageId = this.props.pageId;\n        const field = \"accnos\";\n        let body = {\n            client_code: client_code,\n            page_id: pageId,\n            field: field,\n            new_value: new_value\n        };\n\n        fetch(url, {\n            method: \"POST\",\n            headers: headers,\n            mode: \"cors\",\n            body: JSON.stringify(body)\n        })\n            .then(response => {\n                if (response.ok) {\n                    console.log(response);\n                    return response.json();\n                } else {\n                    throw new Error(\"Something went wrong ...\");\n                }\n            })\n            .then(data => {\n                console.log(data);\n            })\n            .catch(error => console.log(error));\n    };\n\n    onAddingOption = option => {\n        const isChecked = option.target.checked;\n        const name = option.target.name;\n        const value = option.target.value;\n\n        this.setState(prevState => ({\n            optionList: prevState.optionList.map(option =>\n                option.name === value\n                    ? { ...option, isChecked: isChecked }\n                    : option\n            )\n        }));\n\n        if (isChecked) {\n            this.setState(prevState => ({\n                optionsChecked: [\n                    ...prevState.optionsChecked,\n                    { accno: name, name: value }\n                ]\n            }));\n            this.setState(prevState => ({\n                sortableArray: [...prevState.sortableArray, value]\n            }));\n        } else {\n            const newoptionsChecked = this.state.optionsChecked.filter(\n                option => option.name !== value\n            );\n            this.setState({ optionsChecked: newoptionsChecked });\n            const newSortableArray = this.state.sortableArray.filter(\n                option => option !== value\n            );\n            this.setState({ sortableArray: newSortableArray });\n        }\n    };\n\n    render() {\n        if (this.state.error) {\n            return <p>{this.state.error.message}</p>;\n        }\n        if (this.state.isLoading) {\n            return (\n                <div className=\"loader\" id=\"loader-1\">\n                    <span className=\"sr-only\">Loading...</span>\n                </div>\n            );\n        }\n        const option_list = this.state.optionList.map(option => (\n            // const id = \"inlineCheckbox\" + i.toString();\n            <label key={uniqueId()} className=\"checkbox-inline col-md-3\">\n                <input\n                    type=\"checkbox\"\n                    name={option.accno}\n                    value={option.name}\n                    checked={option.isChecked}\n                    onChange={this.onAddingOption}\n                />\n                {option.name}\n            </label>\n        ));\n\n        return (\n            <div id=\"giving-options\" className=\"giving-options\">\n                <h3>Giving Options</h3>\n                <div className=\"apperance\">\n                    <h4>Apperance</h4>\n                    <span className=\"help-block\" id=\"helpBlock\">\n                        Choose which funds are visible on the page\n                    </span>\n\n                    <form>\n                        <div className=\"multi-selection-fund row\">\n                            {option_list}\n                        </div>\n                    </form>\n                    <div className=\"ordering\">\n                        <h4>Ordering</h4>\n                        <span className=\"help-block\" id=\"helpBlock\">\n                            Choose which order the funds are displayed on the\n                            page\n                        </span>\n                        <div id=\"simpleList\" className=\"list-group\">\n                            <SortableList\n                                items={this.state.sortableArray}\n                                onChange={(order, sortable, evt) => {\n                                    this.setState({ sortableArray: order });\n                                }}\n                            />\n                        </div>\n                    </div>\n                </div>\n            </div>\n        );\n    }\n}\n\nexport default FundSelection;\n"]},"metadata":{},"sourceType":"module"}