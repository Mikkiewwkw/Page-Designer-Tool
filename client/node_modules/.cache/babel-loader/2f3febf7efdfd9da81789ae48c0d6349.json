{"ast":null,"code":"var AWS = require('aws-sdk');\n\nconst downloadS3 = (prefix, bucketName) => {\n  const s3 = new AWS.S3();\n  let allKeys = [];\n  s3.config.update({\n    accessKeyId: 'AKIAXKCRRSD3GJHJE65C',\n    secretAccessKey: '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',\n    region: 'us-west-2'\n  });\n  const params = {\n    Bucket: bucketName,\n    Delimiter: '/',\n    Prefix: prefix,\n    StartAfter: prefix\n  };\n  var obj = {\n    length: 0,\n    addElem: function addElem(elem) {\n      // obj.length is automatically incremented\n      // every time an element is added.\n      [].push.call(this, elem);\n    }\n  };\n\n  function listAllKeys() {\n    let i = 0;\n    s3.listObjectsV2(params, (err, data) => {\n      if (err) {\n        console.log(err, err.stack);\n      } else {\n        var contents = data.Contents;\n        console.log(contents);\n        contents.forEach(function (content) {\n          allKeys.push(contents.Key);\n          i++;\n        });\n\n        if (data.IsTruncated) {\n          params.ContinuationToken = data.NextContinuationToken;\n          console.log(\"There are more keys coming up\");\n          listAllKeys();\n        }\n      }\n    }); // console.log(allKeys);\n    // console.log(allKeys.length);\n  }\n\n  listAllKeys();\n  console.log(allKeys); // allKeys.map(key => s3.getSignedUrl('getObject', {Bucket:bucketName,Key:key}, function (err, url) {\n  //     return url;\n  // });\n  //\n  //   var urlparams = {Bucket: 'max-client-logos', Key: allKeys[0]};\n  //   s3.getSignedUrl('getObject', urlparams, function (err, url) {\n  //     console.log('Your generated pre-signed URL is', url);\n  // });\n  //   let url = allKeys.map((key) => (s3.getSignedUrl('getObject', {\n  //     Bucket:\"max-client-logos\",\n  //     Key:key\n  //   }, function(err, url) {\n  //     console.log('Your generated pre-signed URL is', url);\n  //   }\n  // )));\n\n  return obj;\n};\n\nexport default downloadS3;","map":{"version":3,"sources":["/Users/kaiweiwu/Documents/page_designer/page-designer/src/s3config.js"],"names":["AWS","require","downloadS3","prefix","bucketName","s3","S3","allKeys","config","update","accessKeyId","secretAccessKey","region","params","Bucket","Delimiter","Prefix","StartAfter","obj","length","addElem","elem","push","call","listAllKeys","i","listObjectsV2","err","data","console","log","stack","contents","Contents","forEach","content","Key","IsTruncated","ContinuationToken","NextContinuationToken"],"mappings":"AAAA,IAAIA,GAAG,GAAGC,OAAO,CAAC,SAAD,CAAjB;;AAEA,MAAMC,UAAU,GAAG,CAACC,MAAD,EAASC,UAAT,KAAwB;AACzC,QAAMC,EAAE,GAAG,IAAIL,GAAG,CAACM,EAAR,EAAX;AACA,MAAIC,OAAO,GAAG,EAAd;AACAF,EAAAA,EAAE,CAACG,MAAH,CAAUC,MAAV,CAAiB;AACfC,IAAAA,WAAW,EAAC,sBADG;AAEfC,IAAAA,eAAe,EAAC,0CAFD;AAGfC,IAAAA,MAAM,EAAC;AAHQ,GAAjB;AAMA,QAAMC,MAAM,GAAG;AACbC,IAAAA,MAAM,EAAEV,UADK;AAEbW,IAAAA,SAAS,EAAE,GAFE;AAGbC,IAAAA,MAAM,EAAEb,MAHK;AAIbc,IAAAA,UAAU,EAAEd;AAJC,GAAf;AAMA,MAAIe,GAAG,GAAG;AACNC,IAAAA,MAAM,EAAE,CADF;AAGNC,IAAAA,OAAO,EAAE,SAASA,OAAT,CAAiBC,IAAjB,EAAuB;AAC5B;AACA;AACA,SAAGC,IAAH,CAAQC,IAAR,CAAa,IAAb,EAAmBF,IAAnB;AACH;AAPK,GAAV;;AAUA,WAASG,WAAT,GAAsB;AACpB,QAAIC,CAAC,GAAG,CAAR;AACApB,IAAAA,EAAE,CAACqB,aAAH,CAAiBb,MAAjB,EAAyB,CAACc,GAAD,EAAMC,IAAN,KAAe;AACtC,UAAID,GAAJ,EAAS;AACPE,QAAAA,OAAO,CAACC,GAAR,CAAYH,GAAZ,EAAgBA,GAAG,CAACI,KAApB;AACD,OAFD,MAGI;AACF,YAAIC,QAAQ,GAAGJ,IAAI,CAACK,QAApB;AACAJ,QAAAA,OAAO,CAACC,GAAR,CAAYE,QAAZ;AACAA,QAAAA,QAAQ,CAACE,OAAT,CAAiB,UAAUC,OAAV,EAAmB;AAChC5B,UAAAA,OAAO,CAACe,IAAR,CAAaU,QAAQ,CAACI,GAAtB;AACAX,UAAAA,CAAC;AACJ,SAHD;;AAKA,YAAIG,IAAI,CAACS,WAAT,EAAsB;AAClBxB,UAAAA,MAAM,CAACyB,iBAAP,GAA2BV,IAAI,CAACW,qBAAhC;AACAV,UAAAA,OAAO,CAACC,GAAR,CAAY,+BAAZ;AACAN,UAAAA,WAAW;AACd;AACF;AACF,KAlBD,EAFoB,CAqBpB;AACA;AACD;;AACDA,EAAAA,WAAW;AACXK,EAAAA,OAAO,CAACC,GAAR,CAAYvB,OAAZ,EAlDyC,CAoDzC;AACA;AACA;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACE,SAAOW,GAAP;AACD,CApED;;AAsEA,eAAehB,UAAf","sourcesContent":["var AWS = require('aws-sdk');\n\nconst downloadS3 = (prefix, bucketName) => {\n  const s3 = new AWS.S3();\n  let allKeys = [];\n  s3.config.update({\n    accessKeyId:'AKIAXKCRRSD3GJHJE65C',\n    secretAccessKey:'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',\n    region:'us-west-2'\n  });\n\n  const params = {\n    Bucket: bucketName,\n    Delimiter: '/',\n    Prefix: prefix,\n    StartAfter: prefix\n  };\n  var obj = {\n      length: 0,\n\n      addElem: function addElem(elem) {\n          // obj.length is automatically incremented\n          // every time an element is added.\n          [].push.call(this, elem);\n      }\n  };\n\n  function listAllKeys(){\n    let i = 0;\n    s3.listObjectsV2(params, (err, data) => {\n      if (err) {\n        console.log(err,err.stack);\n      }\n      else{\n        var contents = data.Contents;\n        console.log(contents);\n        contents.forEach(function (content) {\n            allKeys.push(contents.Key);\n            i++\n        });\n\n        if (data.IsTruncated) {\n            params.ContinuationToken = data.NextContinuationToken;\n            console.log(\"There are more keys coming up\");\n            listAllKeys();\n        }\n      }\n    })\n    // console.log(allKeys);\n    // console.log(allKeys.length);\n  }\n  listAllKeys();\n  console.log(allKeys);\n\n  // allKeys.map(key => s3.getSignedUrl('getObject', {Bucket:bucketName,Key:key}, function (err, url) {\n  //     return url;\n  // });\n//\n//   var urlparams = {Bucket: 'max-client-logos', Key: allKeys[0]};\n//   s3.getSignedUrl('getObject', urlparams, function (err, url) {\n//     console.log('Your generated pre-signed URL is', url);\n// });\n//   let url = allKeys.map((key) => (s3.getSignedUrl('getObject', {\n//     Bucket:\"max-client-logos\",\n//     Key:key\n//   }, function(err, url) {\n//     console.log('Your generated pre-signed URL is', url);\n//   }\n// )));\n  return obj;\n}\n\nexport default downloadS3;\n"]},"metadata":{},"sourceType":"module"}